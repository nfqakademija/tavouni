{% extends 'base.html.twig' %}

{% form_theme postForm 'bootstrap_3_layout.html.twig' %}
{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/timepicker@1.11.12/jquery.timepicker.min.css">
{% endblock %}
{% block body %}
    <center><h1>Pridėti atsiskaitymą</h1></center>
    <div class="container">
        {{ form_start(postForm) }}
        {{ form_widget(postForm) }}
        <button type="submit" class="btn btn-primary">Pridėti</button>
        {{ form_end(postForm) }}
    </div>
{% endblock %}
{% block javascripts %}
    {{ parent() }}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/timepicker@1.11.12/jquery.timepicker.min.js"></script>
    <script>
        $( function() {
            $( ".js-datepicker" ).datepicker();
        } );
        $('.js-timepicker').timepicker({ 'timeFormat': 'H:i', 'step': 15 });
        var $checkboxInput = $('#assignment_moreOptions');
        $checkboxInput.change(function() {
            var $form = $(this).closest('postForm');
            var checked = this.checked;
            var data = {};
            $.ajax({
                url : $form.attr('action'),
                type: $form.attr('method'),
                data : data,
                success: function(html) {
                    if (checked) {
                        var assignmentEvent =
                            "<div class='form-group' id='assignmentEvent'>" +
                                "<div id='assignment_assignmentEvent'>" +
                                    "<div class='form-group'>" +
                                        "<label class='control-label required' for='assignment_assignmentEvent_rooms'>Rooms</label>" +
                                        "<select id='assignment_assignmentEvent_rooms' name='assignment[assignmentEvent][rooms]' class='form-control'>";
                                        {% for i, room in rooms %}
                                            var roomName = '{{ room.no }}'+' '+'{{ room.building.name }}';
                                            assignmentEvent = assignmentEvent + "<option value="+'{{ i }}'+" class='room_"+ roomName.toLowerCase() +"'>"+ roomName +"</option>";
                                        {% endfor %}
                                        assignmentEvent += "</select>" +
                                    "</div>" +
                                    "<div class='form-group'>" +
                                        "<label class='control-label required' for='assignment_assignmentEvent_start'>Start</label>" +
                                        "<input id='assignment_assignmentEvent_start' name='assignment[assignmentEvent][start]' required='required' class='js-timepicker form-control ui-timepicker-input' autocomplete='off' type='text'>" +
                                    "</div>" +
                                    "<div class='form-group'>" +
                                        "<label class='control-label required' for='assignment_assignmentEvent_end'>End</label>" +
                                        "<input id='assignment_assignmentEvent_end' name='assignment[assignmentEvent][end]' required='required' class='js-timepicker form-control ui-timepicker-input' autocomplete='off' type='text'>" +
                                    "</div>" +
                                "</div>" +
                            "</div>";
                        $("#assignment").append(assignmentEvent);
                        $('.js-timepicker').timepicker({ 'timeFormat': 'H:i', 'step': 15, 'minTime': '8:00am', 'maxTime': '8:00pm' });
                    }
                    else {
                        var item = document.getElementById("assignmentEvent");
                        item.parentNode.removeChild(item);
                    }
                }
            });
        });
    </script>
{% endblock %}

